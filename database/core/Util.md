# Util

## 基本信息
- 文件路径: module/database/src/main/kotlin/taboolib/module/database/Util.kt
- 基本用途: 提供数据库操作的工具函数
- 所属模块: database

## 函数列表

### DataSource.open
> 函数签名: `fun <T> DataSource.open(query: String, autoGeneratedKeys: Int = Statement.RETURN_GENERATED_KEYS, work: (connection: Connection, statement: PreparedStatement) -> T): T`
> 用途: 从数据源获取连接并创建预处理语句，执行操作后自动关闭资源
> 参数:
> - query: 要执行的SQL查询
> - autoGeneratedKeys: 是否返回自动生成的键
> - work: 使用连接和语句执行的操作

### ResultSet.use
> 函数签名: `fun <T> ResultSet.use(func: (resultSet: ResultSet) -> T): T`
> 用途: 在结果集上执行操作，确保操作完成后关闭结果集
> 参数:
> - func: 在结果集上执行的操作

### Connection.use
> 函数签名: `fun <T> Connection.use(func: (connection: Connection) -> T): T`
> 用途: 在数据库连接上执行操作，确保操作完成后关闭连接
> 参数:
> - func: 在连接上执行的操作

### PreparedStatement.use
> 函数签名: `fun <T> PreparedStatement.use(func: (statement: PreparedStatement) -> T): T`
> 用途: 在预处理语句上执行操作，确保操作完成后关闭语句
> 参数:
> - func: 在预处理语句上执行的操作

### Any.asFormattedColumnName
> 函数签名: `internal fun Any.asFormattedColumnName(): String`
> 用途: 将列名格式化为SQL安全的格式，通常是添加反引号
> 特殊处理:
> - "*"和"null"保持原样
> - 包含函数调用的字符串(包含括号)保持原样
> - 已经被反引号包围的字符串保持原样
> - 对于包含点(.)的列名，分别格式化每个部分

## 实现细节
- 所有资源管理函数(use扩展)都遵循try-finally模式确保资源关闭
- DataSource.open组合了Connection.use和PreparedStatement.use
- asFormattedColumnName处理各种特殊情况，确保SQL语句中列名格式正确

## 使用场景
> 安全地管理数据库资源(连接、语句、结果集)
> 执行SQL查询并处理结果
> 格式化SQL语句中的列名和表名

## 注意事项
> 这些函数提供了类似Java 7 try-with-resources的功能
> asFormattedColumnName是内部函数，主要供框架内部使用
> 所有异常都会被重新抛出，但资源会被正确关闭
